<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shorcut icon" href="favicon.ico"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<div style="position:absolute; width:700px; height:500px; background-color: #CCCCCC; overflow: hidden;" id="mapa">mapa se načítá</div>
<script>
function poslat(zoom,xc,yc){
var ajax = (window.XMLHttpRequest ? new XMLHttpRequest() : (window.ActiveXObject ? new ActiveXObject("Microsoft.XMLHTTP") : false));
if(!ajax){
alert("Tak tady to nepoběží!");
return true;
}
ajax.onreadystatechange= function () {zpracuj(ajax,zoom,xc,yc); } ;
ajax.open("GET", "http://localhost/towns2/dat.php?zoom="+zoom+"&xc="+xc+"&yc="+yc, true);
ajax.send(null);
return false
}
function zpracuj(ajax,zoom,xc,yc){
var txt;
if (ajax.readyState == 4){
if(ajax.status == 200 || ajax.status==0){
txt=ajax.responseText;
//---------------------------------------------------------------------------------------------------------------

//dat1 - 2prvni pismena obrazok - 2
//dat2 - zivot - 4
//dat3 - utok - 4
//dat4 - vlastnik - 4
//xc=1;
//yc=1;
//zoom=5;
dxc = xc;
dyc = yc;
xc= xc - 1;
eval(txt);
cash = "";
//evaled = "alert('hura')";
//eval(evaled);


for(var i=0;dat1.charAt(i+1);i=i+2){
zivot="";
utokna="";
zkratka="";
foruser="";
zivotmax="";
vlastnik="";
vlastnikforuser="";
//----------------------------------------
zivot = dat2.charAt(i*2)+""+dat2.charAt(i*2+1)+""+dat2.charAt(i*2+2)+""+dat2.charAt(i*2+3);
//----------------------------------------
utokna = dat3.charAt(i*2)+""+dat3.charAt(i*2+1)+""+dat3.charAt(i*2+2)+""+dat3.charAt(i*2+3);
//----------------------------------------
zkratka = dat1.charAt(i)+""+dat1.charAt(i+1);
if(zkratka == "am"){ zkratka = "ambasada"; foruser="ambasáda"; zivotmax="11111"; }
if(zkratka == "ce"){ zkratka = "cedule"; foruser="cedule"; zivotmax="200"; }
//----------------------------------------
vlastnik = dat4.charAt(i)+""+dat4.charAt(i+1)+""+dat4.charAt(i+2)+""+dat4.charAt(i+3);
vlastnikforuser = "";
eval(usersch);
//----------------------------------------
xc=xc+1;
if(((i+0)/2)/zoom == Math.ceil(((i+0)/2)/zoom)){
cash = cash + ("<br/>");
yc = yc + 1;
xc = dxc;
}

x2 = 100;
y2 = 100;
x2 = x2+((xc-dxc)*25)
y2 = y2+((xc-dxc)*12)
x2 = x2+((yc-dyc)*-25)
y2 = y2+((yc-dyc)*12)


cash = cash + ("<div style=\"position:absolute; left:"+x2+"px; top:"+y2+"px; width:50px; height:25px; z-index:2;\"><a onclick=\"alert('("+xc+","+yc+"), zivot = "+zivot+" / "+zivotmax+", utok = "+utokna+", vlastnik = "+vlastnikforuser+"("+vlastnik+")');\"><img src=\"policko.png\" width=\"50\" height=\"25\" /></a></div>");
cash = cash + ("<div style=\"position:absolute; left:"+x2+"px; top:"+(y2-50)+"px; width:50px; height:25px; z-index:1;\"><img src=\"http://www.towns.cz/casti/jednotky/iso/obrazky/"+zkratka+"/1.gif\" alt=\""+foruser+"\" width=\"50\" height=\"75\" border=\"0\"/></div>");
}

document.getElementById("mapa").innerHTML = cash;


//---------------------------------------------------------------------------------------------------------------
}
else alert("Chyba: "+ ajax.status +":"+ ajax.statusText);
}
}
poslat(6,1,1);
</script>
</body>
</html>
